<!doctype html><html class="theme-next pisces use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css"><meta name="keywords" content="Three.js,TweenMax,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1"><meta name="description" content="本文未涉及详细的代码步骤来深入讲解H5动画的实现过程，只提供一些技术思路和方向，以供深入研究和学习。本文适合对css3与jquery动画库有一定了解的初学者。公司突然要做一个H5广告，老板只有一个要求，就是要有3D效果，要向《穿越故宫来看你》、《淘宝造物节》等大神级作品看齐。回头看下只有1个策划2个美工3个前端的团队，额，臣妾做不到啊。但是老板要求了，别说要搞3D动画，就算他想搞原子弹，我们也要想"><meta property="og:type" content="article"><meta property="og:title" content="Three.js+TweenMax帮你实现骚气的H5动画广告"><meta property="og:url" content="http://zkzhao.github.io/6IeVPTJlGdtsxb0AAqk6ug.html"><meta property="og:site_name" content="ZKZhao's Life"><meta property="og:description" content="本文未涉及详细的代码步骤来深入讲解H5动画的实现过程，只提供一些技术思路和方向，以供深入研究和学习。本文适合对css3与jquery动画库有一定了解的初学者。公司突然要做一个H5广告，老板只有一个要求，就是要有3D效果，要向《穿越故宫来看你》、《淘宝造物节》等大神级作品看齐。回头看下只有1个策划2个美工3个前端的团队，额，臣妾做不到啊。但是老板要求了，别说要搞3D动画，就算他想搞原子弹，我们也要想"><meta property="og:image" content="http://7xk7wj.com1.z0.glb.clouddn.com/blog_zaowujie.png"><meta property="og:image" content="http://7xk7wj.com1.z0.glb.clouddn.com/blog_2259286548-5748f6ff2ca90_articlex.png"><meta property="og:updated_time" content="2016-11-02T07:35:42.066Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Three.js+TweenMax帮你实现骚气的H5动画广告"><meta name="twitter:description" content="本文未涉及详细的代码步骤来深入讲解H5动画的实现过程，只提供一些技术思路和方向，以供深入研究和学习。本文适合对css3与jquery动画库有一定了解的初学者。公司突然要做一个H5广告，老板只有一个要求，就是要有3D效果，要向《穿越故宫来看你》、《淘宝造物节》等大神级作品看齐。回头看下只有1个策划2个美工3个前端的团队，额，臣妾做不到啊。但是老板要求了，别说要搞3D动画，就算他想搞原子弹，我们也要想"><meta name="twitter:image" content="http://7xk7wj.com1.z0.glb.clouddn.com/blog_zaowujie.png"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Pisces",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:0,author:"博主"}}</script><link rel="canonical" href="http://zkzhao.github.io/6IeVPTJlGdtsxb0AAqk6ug.html"><title>Three.js+TweenMax帮你实现骚气的H5动画广告 | ZKZhao's Life</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?111d2f33ecb41b249b9f0696a30afbe3";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ZKZhao's Life</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">学习生活记录</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline">Three.js+TweenMax帮你实现骚气的H5动画广告</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2016-11-02T15:30:18+08:00" content="2016-11-02">2016-11-02 </time></span><span class="post-category">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/动画特效/" itemprop="url" rel="index"><span itemprop="name">动画特效</span> </a></span>， <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/动画特效/3D/" itemprop="url" rel="index"><span itemprop="name">3D</span> </a></span></span><span class="post-comments-count">&nbsp; | &nbsp; <a href="/6IeVPTJlGdtsxb0AAqk6ug.html#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="6IeVPTJlGdtsxb0AAqk6ug.html" itemprop="commentsCount"></span> </a></span><span id="/6IeVPTJlGdtsxb0AAqk6ug.html" class="leancloud_visitors" data-flag-title="Three.js+TweenMax帮你实现骚气的H5动画广告">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>本文未涉及详细的代码步骤来深入讲解H5动画的实现过程，只提供一些技术思路和方向，以供深入研究和学习。本文适合对css3与jquery动画库有一定了解的初学者。</p></blockquote><p>公司突然要做一个H5广告，老板只有一个要求，就是要有3D效果，要向《穿越故宫来看你》、《淘宝造物节》等大神级作品看齐。回头看下只有1个策划2个美工3个前端的团队，额，臣妾做不到啊。但是老板要求了，别说要搞3D动画，就算他想搞原子弹，我们也要想办法弄清楚原子弹的设计原理，做不出大神级别H5，做个草根山寨版的也行啊，劳动人民的智慧总是无穷无尽的…..<br><a id="more"></a></p><h2 id="视频动画"><a href="#视频动画" class="headerlink" title="视频动画"></a>视频动画</h2><p>要做H5的3D动画广告，最先想到的就是视频了，这种方式当然对我们前端程序员来说是最省事的，只需要找相关视频制作的专业人事，做出一个狂拽酷炫吊炸天的视频，然后嵌入H5页面就搞定了。其中唯一需要担心的是网页视频在安卓设备上播放的时候，会默认冒出播放器的进度条。最简单粗暴的解决办法就是把视频的尺寸放大，让进度条飞出显示屏，嗯，完美。当然还有唯二需要担心的事情，比如公司没有这么一个会做视频的人…..</p><h2 id="幻灯片图片动画"><a href="#幻灯片图片动画" class="headerlink" title="幻灯片图片动画"></a>幻灯片图片动画</h2><p>相信大家小时候都玩过书角动画（也叫手翻书），每一页的动画都有细微的差别，快速翻过由于视觉停留的缘故，看起来就像连续不间断的动画。H5动画广告也使用这种方法，<em>在视频软件中制作特效后再导出为序列帧图片</em>，设置时间间隔后让它们一张一张连续播放，再加一段音频字幕，完全可以以假乱真，假装自己是视频了。有的同学要问，那为什么不直接用视频呢？原因很简单，视频不能和用户交互呀！视频前端程序员不会做呀！对呀！不会做呀，那怎么导出连贯的静态图片？这个方案也不行，放弃。继续往下看吧。</p><h2 id="补间动画和CSS3-3D转换"><a href="#补间动画和CSS3-3D转换" class="headerlink" title="补间动画和CSS3 3D转换"></a>补间动画和CSS3 3D转换</h2><p>既然前2种方法中的视频制作对我们来说有些难度，那我们还是回归本质，运用自己最擅长的css和js来解决问题。</p><p><img src="http://7xk7wj.com1.z0.glb.clouddn.com/blog_zaowujie.png" alt=""></p><p>看到这张<strong>淘宝造物节作者</strong>的聊天记录截图，瞬间感觉被开启了新世界的大门，原来造物节广告是利用css3 3d转换实现的全景伪3d，不得不佩服这位设计师大神的智慧，把css3玩出了新的高度。他使用动画库jstween、css3d、陀螺仪orienter.js（用于横竖屏重力感应）等技术完成了这部作品。那我们先从简单的开始研究，jstween动画库是造物节作者自己封装的一个js动画库，适合设计大师的不一定适合自己，我们还是选个文档齐全点的来玩吧。要做补间动画最重要的就是timeline，GSAP的TimeLineMax库可以很方便的管理时间轴动画，但是GSAP提供了TweenLite.js、TweenMax.js、TimelineLite.js和TimelineMax.js 4个文件，不用一脸懵逼，下面就介绍一下这些引用库文件都是做什么的。</p><ul><li><strong>TweenLite</strong> 是GSAP的主体核心，它用于创建基本动画，是其他各类模块的基础。一般都会搭配plugins/CSSPlugin以实现DOM元素的动画（也就是我们最熟悉的动画了）。</li><li><strong>TimelineLite</strong> 是一个叫做时间轴的动画容器，它用于对多个动画进行有序的组织与控制。</li><li><strong>TimeLineMax</strong> 是TimelineLite的升级版，在TimelineLite的基础之上，可以有更高级的组织与控制。</li><li><strong>TweenMax</strong> 是GSAP集合包，除前面3个之外，还包括plugins里的常用插件以及easing里的缓动函数补充。</li></ul><p>因此，如果想要简单地引入GSAP的主体功能，使用TweenMax.js这一个文件即可。而如果要争取更小的库文件大小，应该使用TweenLite.js（必需）+ 其他文件的组合。下面是它们的重叠包含关系图。</p><p><img src="http://7xk7wj.com1.z0.glb.clouddn.com/blog_2259286548-5748f6ff2ca90_articlex.png" alt=""></p><p>搞明白这些概念之后，剩下的就简单了，只需要打开 <a href="http://greensock.com/tweenlite" target="_blank" rel="external">文档</a> ，做几个Deom就什么都会了（毕竟更深的东西暂时也用不到）。下面给出一个简单的时间轴实现代码，只需要to to to to…..就完成了，是不是很容易。<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tl = <span class="keyword">new</span> TimelineLite();</div><div class="line">tl.to($box, <span class="number">1</span>, &#123;x:<span class="number">50</span>,y:<span class="number">0</span>&#125;)</div><div class="line">  .to($box, <span class="number">1</span>, &#123;x:<span class="number">50</span>,y:<span class="number">50</span>&#125;)</div><div class="line">  .to($box, <span class="number">1</span>, &#123;x:<span class="number">-50</span>,y:<span class="number">50</span>&#125;)</div><div class="line">  .to($box, <span class="number">1</span>, &#123;x:<span class="number">-50</span>,y:<span class="number">0</span>&#125;);</div></pre></td></tr></table></figure><p></p><p>GSAP还非常贴心的给出了一份包含丰富参考代码的 <a href="https://ihatetomatoes.net/wp-content/uploads/2016/07/GreenSock-Cheatsheet-4.pdf" target="_blank" rel="external">备忘单（Cheat Sheet）</a>。</p><p>##真正的3D动画webGL库—threejs<br>在H5内想实现空间变换和推拉的效果，面对很多素材的大型场景时，灵巧的css3 3d空间变换显得十分吃力。为了更好的效率和流畅的体验，可以选用webGL来绘制3D场景，通过3DMAX、玛雅等工具建模后导入3d模型进行外部模型加载。</p><p>制作三维场景的基本要素：</p><ol><li><p>场景（Scene）：模型、灯光等；<br>场景就是要在三维中显示的内容，好比电影中的场地、演员、道具，有了场景就知道要在三维中显示什么内容。</p></li><li><p>相机（Camera）：观察场景的视角；<br>相机是用来观察场景的视角，好比电影中的摄像机，有了相机元素才能把场景中的内容获取下来，相机控制是场景交互和动画的基础。</p></li><li><p>渲染器（Renderer）：场景渲染输出的目标；</p></li><li>渲染（render）：执行渲染操作；</li></ol><p>下面有一个简单的使用three.js实现3d模型的详细例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建场景元素对象</span></div><div class="line"><span class="keyword">var</span> scene= <span class="keyword">new</span> THREE.Scene();  </div><div class="line"><span class="comment">// 模型对象（100,100,100分别为长宽高）</span></div><div class="line"><span class="keyword">var</span> geometry= <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">100</span>,<span class="number">100</span>,<span class="number">100</span>);  </div><div class="line"><span class="comment">//材质对象 （红色的材质）</span></div><div class="line"><span class="keyword">var</span> material= <span class="keyword">new</span> THREE.MeshLamberMaterial(&#123;color: <span class="number">0xff0000</span>&#125;); </div><div class="line"><span class="comment">// 添加网格模型</span></div><div class="line"><span class="keyword">var</span> mesh= <span class="keyword">new</span> THREE.Mesh(geometry,material); </div><div class="line"><span class="comment">//将mesh对象加入场景中</span></div><div class="line">scene.add(mesh) ;</div><div class="line"><span class="comment">// 添加灯光（白色的点光源）</span></div><div class="line"><span class="keyword">var</span> light= <span class="keyword">new</span> THREE.PointLight(<span class="number">0xffffff</span>) ;</div><div class="line"><span class="comment">// 设置光源的位置</span></div><div class="line">light.position.set(<span class="number">300</span>,<span class="number">400</span>,<span class="number">200</span>);</div><div class="line"><span class="comment">// 将光源加入场景之中</span></div><div class="line">scene.add(light);</div><div class="line"><span class="comment">// 创建相机对象（透视相机）</span></div><div class="line"><span class="keyword">var</span> camera= <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">40</span>,<span class="number">800</span>/<span class="number">600</span>,<span class="number">1</span>,<span class="number">1000</span>);</div><div class="line"><span class="comment">// 设置相机的位置</span></div><div class="line">camera.position.set(<span class="number">200</span>,<span class="number">200</span>,<span class="number">200</span>);</div><div class="line"><span class="comment">// 将相机朝向场景的中心</span></div><div class="line">camera.lookAt(scene.position);</div><div class="line"><span class="comment">// 创建WebGL渲染器</span></div><div class="line"><span class="keyword">var</span> renderer= <span class="keyword">new</span> THREE.WebGLRenderer();</div><div class="line"><span class="comment">// 设置渲染器的尺寸</span></div><div class="line">renderer.setSize(<span class="number">800</span>,<span class="number">600</span>);</div><div class="line"><span class="built_in">document</span>.body.appendChild(renderer.domElement);</div><div class="line"><span class="comment">//渲染 场景和相机</span></div><div class="line">renderer.render(scene,camera);</div></pre></td></tr></table></figure><p>总结：实际上H5广告的技术并不算难，工作量基本耗费在美术素材上，有点人海战术的意思，依靠大量元素的视觉轰炸来达到惊艳的视觉体验。</p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Three-js/" rel="tag">#Three.js</a> <a href="/tags/TweenMax/" rel="tag">#TweenMax</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/hJN-n3Pj0BAbWkD90DFlBg.html" rel="next" title="Webpack Development Server 开发服务器详解"><i class="fa fa-chevron-left"></i> Webpack Development Server 开发服务器详解</a></div><div class="post-nav-prev post-nav-item"></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div class="ds-thread" data-thread-key="6IeVPTJlGdtsxb0AAqk6ug.html" data-title="Three.js+TweenMax帮你实现骚气的H5动画广告" data-url="http://zkzhao.github.io/6IeVPTJlGdtsxb0AAqk6ug.html"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="http://7xk7wj.com1.z0.glb.clouddn.com/blog_zzz.jpg" alt="zkzhao"><p class="site-author-name" itemprop="name">zkzhao</p><p class="site-description motion-element" itemprop="description">是爆炸头造就了拳王，而不是拳王造就了爆炸头！</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">8</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories"><span class="site-state-item-count">15</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">10</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zkzhao" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#视频动画"><span class="nav-number">1.</span> <span class="nav-text">视频动画</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#幻灯片图片动画"><span class="nav-number">2.</span> <span class="nav-text">幻灯片图片动画</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#补间动画和CSS3-3D转换"><span class="nav-number">3.</span> <span class="nav-text">补间动画和CSS3 3D转换</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2016</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">zkzhao</span></div><div class="powered-by">版权声明</div><div class="theme-info">自由转载-非商用-非衍生-保持署名</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script><script type="text/javascript">var duoshuoQuery={short_name:"zkzhao"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.id="duoshuo-script",t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script><script src="/js/src/hook-duoshuo.js"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("Wj2c2HrnCXJsLd1aSRodWRhT-gzGzoHsz","pwBh9n0dzUeq927dxY6kjoVB")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>